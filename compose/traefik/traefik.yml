# =============================================================================
# Traefik Global Configuration (Static)
# =============================================================================
# Это статическая конфигурация Traefik, которая требует перезапуска при изменении.
# Для динамической конфигурации (без перезапуска) см. dynamic.yml
#
# Traefik v3.6.7 Documentation: https://doc.traefik.io/traefik/v3.6/
# =============================================================================

# ---------------------------------------------------------------------------
# API & Dashboard Configuration
# ---------------------------------------------------------------------------
# Dashboard - веб-интерфейс для мониторинга Traefik
# ---------------------------------------------------------------------------
api:
  dashboard: true  # Включить Dashboard

  # ⚠️ ВАЖНО: insecure: true позволяет доступ к Dashboard без middleware
  # Рекомендуется убрать это после настройки Basic Auth (см. docs/08_security.md)
  # Когда insecure: false, доступ только через middleware в dynamic.yml
  insecure: true  # TODO: Убрать после настройки Basic Auth

# ---------------------------------------------------------------------------
# EntryPoints - Точки входа для трафика
# ---------------------------------------------------------------------------
# EntryPoints - это порты, которые Traefik слушает для входящих запросов
# ---------------------------------------------------------------------------
entryPoints:
  # ---------------------------------------------------------------------------
  # Web EntryPoint (HTTP)
  # ---------------------------------------------------------------------------
  # Порт 80 для незашифрованного HTTP трафика
  # Используется для:
  #   - Локальных сервисов (.home.local)
  #   - HTTP challenge для Let's Encrypt (когда будет настроен)
  # ---------------------------------------------------------------------------
  web:
    address: ":80"  # Слушать на порту 80

  # ---------------------------------------------------------------------------
  # WebSecure EntryPoint (HTTPS)
  # ---------------------------------------------------------------------------
  # Порт 443 для зашифрованного HTTPS трафика
  # Будет использоваться для:
  #   - Внешних сервисов с Let's Encrypt сертификатами
  #   - TLS termination
  # ---------------------------------------------------------------------------
  websecure:
    address: ":443"  # Слушать на порту 443

# ---------------------------------------------------------------------------
# Providers - Источники конфигурации
# ---------------------------------------------------------------------------
# Providers предоставляют Traefik информацию о routings, services, middlewares
# ---------------------------------------------------------------------------
providers:
  # ---------------------------------------------------------------------------
  # Docker Provider - Автоматическое обнаружение контейнеров
  # ---------------------------------------------------------------------------
  # Traefik автоматически обнаруживает Docker контейнеры и создаёт routing
  # на основе Docker labels. Контейнеры без labels игнорируются.
  #
  # Docs: https://doc.traefik.io/traefik/providers/docker/
  # ---------------------------------------------------------------------------
  docker:
    # Endpoint для Docker API (unix socket)
    endpoint: "unix:///var/run/docker.sock"

    # ⚠️ ВАЖНО: exposedByDefault: false повышает безопасность
    # Только контейнеры с label "traefik.enable=true" будут доступны
    # Это предотвращает случайный exposure сервисов
    exposedByDefault: false

    # Сеть Docker, в которой Traefик будет искать контейнеры
    # "internal" сеть изолирована от интернета, но Traefik может маршрутизировать
    # запросы с public сети на эту internal сеть
    network: internal

  # ---------------------------------------------------------------------------
  # File Provider - Динамическая конфигурация из файла
  # ---------------------------------------------------------------------------
  # Позволяет определять routers, middlewares, services в файле
  # и обновлять их БЕЗ перезапуска Traefik.
  #
  # Docs: https://doc.traefik.io/traefik/providers/file/
  # ---------------------------------------------------------------------------
  file:
    # Путь к файлу с динамической конфигурацией
    filename: /etc/traefik/dynamic.yml

    # watch: true означает, что Traefik будет следить за изменениями файла
    # и автоматически применять их без перезапуска
    watch: true

# ---------------------------------------------------------------------------
# Logging Configuration
# ---------------------------------------------------------------------------
# Настройка логов Traefik для troubleshooting и мониторинга
# ---------------------------------------------------------------------------
log:
  # Уровень логирования: DEBUG, INFO, WARN, ERROR
  # DEBUG - очень подробные логи (только для troubleshooting)
  # INFO  - нормальный уровень (рекомендуется для production)
  level: INFO

# Access Log - логирование всех HTTP запросов
# Полезно для анализа трафика и troubleshooting
accessLog: {}  # Пустые {} = настройки по умолчанию

# ---------------------------------------------------------------------------
# Certificate Resolvers - Автоматическое получение SSL сертификатов
# ---------------------------------------------------------------------------
# Let's Encrypt resolver для автоматического получения HTTPS сертификатов
# Currently commented out - раскомментируйте когда будете готовы настроить HTTPS
#
# Requirements:
#   - Доменное имя (не .home.local!)
#   - DNS A record指向 ваш IP
#   - Открытый порт 443
#
# Docs: https://doc.traefik.io/traefik/https/acme/
# ---------------------------------------------------------------------------
#certificatesResolvers:
#  letsencrypt:
#    acme:
#      # Email для уведомлений об истечении сертификатов
#      email: your-email@example.com  # ЗАМЕНИТЕ на ваш email!
#
#      # Хранилище сертификатов (файл или key-value store)
#      storage: /letsencrypt/acme.json
#
#      # HTTP Challenge - способ верификации домена
#      # Traefik создаёт временный файл на http://domain/.well-known/acme-challenge/
#      # Let's Encrypt проверяет этот файл для подтверждения владения доменом
#      httpChallenge:
#        entryPoint: web  # EntryPoint для challenge (порт 80)
