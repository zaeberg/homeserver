# Динамическая конфигурация Traefik
# Здесь можно переопределять настройки без перезапуска

http:
  routers:
    # Traefik Dashboard
    dashboard:
      rule: "Host(`traefik.home.local`)"
      service: "api@internal"
      entryPoints:
        - "web"
      middlewares:
        - "dashboard-to-root"

  middlewares:
    # Редирект с / на /dashboard/ для удобства
    dashboard-to-root:
      redirectRegex:
        regex: "^http://traefik.home.local/?$"
        replacement: "http://traefik.home.local/dashboard/"
        permanent: false

    # Middleware для добавления общих заголовков безопасности
    security-headers:
      headers:
        sslRedirect: false
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        forceSTSHeader: true
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "no-referrer"
        customFrameOptionsValue: "SAMEORIGIN"

# Для Basic Auth на dashboard Traefik (раскомментируйте когда понадобится)
# Не забудьте сгенерировать хеш пароля: echo $(htpasswd -nb user password) | sed -e s/\\$/\\$\\$/g
#
#  middlewares:
#    traefik-auth:
#      basicAuth:
#        users:
#          - "user:$apr1$hash..."
